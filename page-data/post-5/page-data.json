{
    "componentChunkName": "component---src-templates-blog-post-tsx",
    "path": "/post-5/",
    "result": {"data":{"site":{"siteMetadata":{"title":"paerck25.logger"}},"markdownRemark":{"id":"c994b363-a1e2-57f3-9412-87f96e3391b6","excerpt":"저희 레포지토리는 main 브랜치와 develop 브랜치를 나눠서 develop 브랜치에서 테스트, QA를 다 마치고 release할 때만 main 브랜치에 올리는 방식으로 배포를 하고 있습니다.\n\n얼마 전에 develop 브랜치에서 테스트를 다 마치고 main…","html":"<p>저희 레포지토리는 main 브랜치와 develop 브랜치를 나눠서 develop 브랜치에서 테스트, QA를 다 마치고 release할 때만 main 브랜치에 올리는 방식으로 배포를 하고 있습니다.<br>\n<br>\n얼마 전에 develop 브랜치에서 테스트를 다 마치고 main 브랜치에 올려서 배포를 하였는데, 어째선지 500 에러를 뱉어내며 제대로 동작하지 않았습니다.<br>\n계속 원인을 찾아보다가 도저히 못 찾겠어서 롤백을 하려 했는데 여태 release 버전 관리를 해오지 않아서 이전 버전의 커밋이 어디까지인지 몰라 롤백조차도 제대로 하지 못하였습니다.<br>\n<br>\n결국, 원인을 찾았지만(코드 문제가 아닌 db의 문제), 거의 30~40분 동안 서비스가 중지가 되버렸습니다.<br>\n추후 이런일이 없도록 버전 관리를 해야만 하겠다고 생각이 들었고,<br>\n수동으로 하면 귀찮으니 자동화를 하였습니다.</p>\n<h2>Github Action 워크플로우</h2>\n<p>얼마전에 무중단 배포를 구축할때도 사용하였지만<br>\n한번 사용법을 익혀두니까 여러모로 잘 써먹고 있는 것 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">name: Create Release\n\non:\n    pull_request:\n        types: [closed]\n        branches:\n            - main\n\njobs:\n    create-relase:\n        if: github.event.pull_request.merged == true\n        runs-on: ubuntu-latest\n        steps:\n            - name: Checkout code\n              uses: actions/checkout@master\n            - name: Create Release\n              id: create_release\n              uses: actions/create-release@v1\n              env:\n                  GITHUB_TOKEN: ${{ secrets.GIT_AUTH_TOKEN }}\n              with:\n                  tag_name: ${{ github.event.pull_request.title }}\n                  release_name: ${{ github.event.pull_request.title }}\n                  body: ${{ github.event.pull_request.body }}\n</code></pre></div>\n<p>생각보다 간단하게 작성할 수 있었습니다.<br>\n<br>\n먼저, 트리거를 보시면 main 브랜치에 올라온 pull_request가 closed 되었을 때 실행되도록 작성하였습니다.<br>\n트리거로 [push]를 사용하지 않은 이유는 아래에서 pull_request의 title로 태그와 릴리즈를 만들기 때문에, main 브랜치에 바로 push하는 커밋들에는 실행되지 않았으면 하였습니다.<br>\n<br>\n그리고 jobs를 보시면 pull_request가 merge가 되었을 때만 실행되도록 if 조건을 걸어두었습니다.<br>\n이걸 해두지 않으면 PR을 올리고 모종의 이유로 PR을 merge하지 않고 close하였을 때도 실행이 되므로 그것을 방지하였습니다.<br>\n<br>\n그 외에는 레포지토리에 Secret Key를 GIT_AUTH_TOKEN 이라는 이름으로 등록하여 사용하였고, 태그명,버전명, 내용은 pull_request와 같도록 작성하였습니다.</p>\n<h2>테스트</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1357a53f60aa037e0bff320f3c50e9cf/e8e04/pr_title.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABPUlEQVQoz2WRfW7DIAzFc/877J8dYCeaVq1t0iTki4CBQOBNdpR22pB+esZ+GJArAIgpCXsuyLkg7Rkx7dhzfuZYE+f2LPuSITF7zjpTcUPjAoZJo1Mj7k2LaVlhyKEfRjw6hVv9wKPrYcjje2hwUTW+1B3NqPDoBqHtB7RqPBqqrgMRSePVOlgXQCFCWwdtCMtqRclHaHJYiDBZi5U8VuvFx8pUOWd8vL+hrluodcfntcewRiyuCDPlJ5PdRRfhVTu9nD++bAy2mDCbgKZfoInjTTA+w/hd1Ib/cG2x/PIo56pSCs4VQoDWGkCRS8g5/F6lZLD/0Cy+lBKMtXDOwXt/NDzRq0XTKjRtL8NhbnWLy/Uug/JbBPkNjgmnRvgtHYT4eiErT3FajAxhnLXEszaYtIGhIIe54Yu/+w0/cJRqtYmUP+QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pr_title\"\n        title=\"pr_title\"\n        src=\"/static/1357a53f60aa037e0bff320f3c50e9cf/f058b/pr_title.png\"\n        srcset=\"/static/1357a53f60aa037e0bff320f3c50e9cf/c26ae/pr_title.png 158w,\n/static/1357a53f60aa037e0bff320f3c50e9cf/6bdcf/pr_title.png 315w,\n/static/1357a53f60aa037e0bff320f3c50e9cf/f058b/pr_title.png 630w,\n/static/1357a53f60aa037e0bff320f3c50e9cf/40601/pr_title.png 945w,\n/static/1357a53f60aa037e0bff320f3c50e9cf/78612/pr_title.png 1260w,\n/static/1357a53f60aa037e0bff320f3c50e9cf/e8e04/pr_title.png 1270w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>main 브랜치로 Pull Request를 작성할 때 버전을 쓰고, 내용을 채운 후</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9402cef321da51515f52a0518cf4ab5e/f680b/pr_merge.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.354430379746837%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAyklEQVQY02WOXW6DMBCEOWOv1Ev1EK36UrVqicE/uIloQIBJAIP9VTgvqbrSt9rZmYfJ9MfENG6EDeIdYb3T4aYJ/z0/hz9kjw8l4nVmcB1KVVTVN1pb6vrM0R6xxqKV4XSqkVInf7+NsYkYSYQtJrLnp57hJ9D1HYWUHIoioY3hTUhecsW7kCit+cxzRFmijOErP5ALwblpWLe9/m2yfW1r5OpWRrdwcZ6LW7iOnqb32Hah7T3jMCdvz7hhxvVT+rWNS1k/R5Yp8At5wy/LDetp9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"pr_merge\"\n        title=\"pr_merge\"\n        src=\"/static/9402cef321da51515f52a0518cf4ab5e/f058b/pr_merge.png\"\n        srcset=\"/static/9402cef321da51515f52a0518cf4ab5e/c26ae/pr_merge.png 158w,\n/static/9402cef321da51515f52a0518cf4ab5e/6bdcf/pr_merge.png 315w,\n/static/9402cef321da51515f52a0518cf4ab5e/f058b/pr_merge.png 630w,\n/static/9402cef321da51515f52a0518cf4ab5e/40601/pr_merge.png 945w,\n/static/9402cef321da51515f52a0518cf4ab5e/f680b/pr_merge.png 1108w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>머지를 하면</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21390c447c35a27873ffed3dc6033bd6/6568d/done.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.87341772151899%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8ElEQVQoz31S7Y7DIAzr+7/h9rfr1NKPQWk7ICE+AWrvbutmyQpEkeMEKhFBAjMjhABiRsolpjMRgYgRoyDG+IdyyiqJpYK2baFUD601dnRK4XK5ou06GLLwMeAXgjMUQWY0txuGcUKUWMpFYK3NTfp+QNsr9MOAcZzyJHvNm+Ce1Mbi3inY54riWvIaUvQhwDkP51wmczzW8spDcJ4ttJmzQOkOmHlGXdd4bts/F5/EsuCZ9f2+LCsaZaC0x7QQPBVn+QHknIfD926A9x6d9mgehPsjwGzlB8QvrF6XugvmNSwrnCcQCwLHHL+Nm0b+AaH2dR87MAn3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"done\"\n        title=\"done\"\n        src=\"/static/21390c447c35a27873ffed3dc6033bd6/f058b/done.png\"\n        srcset=\"/static/21390c447c35a27873ffed3dc6033bd6/c26ae/done.png 158w,\n/static/21390c447c35a27873ffed3dc6033bd6/6bdcf/done.png 315w,\n/static/21390c447c35a27873ffed3dc6033bd6/f058b/done.png 630w,\n/static/21390c447c35a27873ffed3dc6033bd6/40601/done.png 945w,\n/static/21390c447c35a27873ffed3dc6033bd6/78612/done.png 1260w,\n/static/21390c447c35a27873ffed3dc6033bd6/6568d/done.png 1660w\"\n        sizes=\"(max-width: 630px) 100vw, 630px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>이렇게 태그와 버전이 생성되었습니다.\n<br>\n<br></p>","frontmatter":{"title":"Github Action - 태그, 버전 릴리즈 자동화하기","date":"2022-03-16, 11:00 pm","description":"버전 관리"}},"previous":{"fields":{"slug":"/post-4/"},"frontmatter":{"title":"무중단 배포 구축하기 - docker"}},"next":{"fields":{"slug":"/post-6/"},"frontmatter":{"title":"React Build Error 기록 - nginx 404, ChunkLoadError"}}},"pageContext":{"id":"c994b363-a1e2-57f3-9412-87f96e3391b6","previousPostId":"d0adaccc-39b8-5204-948c-ff8abd7ff381","nextPostId":"d960ac2f-26da-5e63-b0bb-25fa8cc2bba8"}},
    "staticQueryHashes": ["2841359383","3257411868"]}